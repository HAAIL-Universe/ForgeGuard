============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\krisd\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: Z:\ForgeCollection\ForgeGuard
plugins: anyio-4.9.0, langsmith-0.4.6, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 737 items

tests/test_agent_client.py::test_query_agent_success PASSED              [  0%]
tests/test_agent_client.py::test_query_agent_empty_content PASSED        [  0%]
tests/test_agent_client.py::test_query_agent_no_text_block PASSED        [  0%]
tests/test_agent_client.py::test_query_agent_headers PASSED              [  0%]
tests/test_agent_client.py::test_query_agent_max_tokens PASSED           [  0%]
tests/test_agent_client.py::test_stream_agent_text_only PASSED           [  0%]
tests/test_agent_client.py::test_stream_agent_tool_use PASSED            [  0%]
tests/test_agent_client.py::test_stream_agent_mixed_text_and_tool PASSED [  1%]
tests/test_agent_client.py::test_stream_agent_tools_in_payload PASSED    [  1%]
tests/test_agent_client.py::test_stream_agent_no_tools_omits_from_payload PASSED [  1%]
tests/test_agent_client.py::test_stream_agent_malformed_tool_json PASSED [  1%]
tests/test_agent_client.py::test_token_budget_limiter_init PASSED        [  1%]
tests/test_agent_client.py::test_token_budget_limiter_record_and_usage PASSED [  1%]
tests/test_agent_client.py::test_token_budget_limiter_no_wait_under_budget PASSED [  1%]
tests/test_agent_client.py::test_token_budget_limiter_waits_when_over_budget PASSED [  2%]
tests/test_agent_client.py::test_token_budget_limiter_purge PASSED       [  2%]
tests/test_agent_client.py::test_get_limiter_singleton PASSED            [  2%]
tests/test_agent_client.py::test_stream_usage_cache_fields PASSED        [  2%]
tests/test_agent_client.py::test_headers_include_caching PASSED          [  2%]
tests/test_agent_client.py::test_token_budget_limiter_cache_reads_excluded PASSED [  2%]
tests/test_agent_client.py::test_stream_agent_all_tokens_counted_for_limiter PASSED [  2%]
tests/test_agent_client.py::test_api_key_pool_init_single_key PASSED     [  2%]
tests/test_agent_client.py::test_api_key_pool_init_multiple_keys PASSED  [  3%]
tests/test_agent_client.py::test_api_key_pool_deduplicates PASSED        [  3%]
tests/test_agent_client.py::test_api_key_pool_rejects_empty PASSED       [  3%]
tests/test_agent_client.py::test_api_key_pool_best_key_selects_least_loaded PASSED [  3%]
tests/test_agent_client.py::test_api_key_pool_aggregate_usage PASSED     [  3%]
tests/test_agent_client.py::test_get_key_pool_singleton PASSED           [  3%]
tests/test_architecture_mapper.py::test_classify_flat PASSED             [  3%]
tests/test_architecture_mapper.py::test_classify_layered PASSED          [  4%]
tests/test_architecture_mapper.py::test_classify_monorepo PASSED         [  4%]
tests/test_architecture_mapper.py::test_find_entry_points PASSED         [  4%]
tests/test_architecture_mapper.py::test_map_directories PASSED           [  4%]
tests/test_architecture_mapper.py::test_extract_fastapi_routes PASSED    [  4%]
tests/test_architecture_mapper.py::test_extract_flask_routes PASSED      [  4%]
tests/test_architecture_mapper.py::test_extract_express_routes PASSED    [  4%]
tests/test_architecture_mapper.py::test_find_sql_tables PASSED           [  5%]
tests/test_architecture_mapper.py::test_find_sqlalchemy_models PASSED    [  5%]
tests/test_architecture_mapper.py::test_find_python_integrations PASSED  [  5%]
tests/test_architecture_mapper.py::test_find_no_integrations PASSED      [  5%]
tests/test_architecture_mapper.py::test_find_config_sources PASSED       [  5%]
tests/test_architecture_mapper.py::test_check_boundaries_present PASSED  [  5%]
tests/test_architecture_mapper.py::test_check_boundaries_absent PASSED   [  5%]
tests/test_architecture_mapper.py::test_estimate_coverage_high PASSED    [  5%]
tests/test_architecture_mapper.py::test_estimate_coverage_medium PASSED  [  6%]
tests/test_architecture_mapper.py::test_estimate_coverage_low PASSED     [  6%]
tests/test_architecture_mapper.py::test_estimate_coverage_none PASSED    [  6%]
tests/test_architecture_mapper.py::test_estimate_coverage_no_source PASSED [  6%]
tests/test_architecture_mapper.py::test_map_architecture_complete PASSED [  6%]
tests/test_architecture_mapper.py::test_map_architecture_empty PASSED    [  6%]
tests/test_audit_engine.py::TestBoundaryCompliance::test_pass_when_no_boundaries PASSED [  6%]
tests/test_audit_engine.py::TestBoundaryCompliance::test_pass_when_no_violations PASSED [  7%]
tests/test_audit_engine.py::TestBoundaryCompliance::test_fail_on_violation PASSED [  7%]
tests/test_audit_engine.py::TestDependencyGate::test_pass_normal_imports PASSED [  7%]
tests/test_audit_engine.py::TestDependencyGate::test_fail_wildcard_import PASSED [  7%]
tests/test_audit_engine.py::TestSecretsScan::test_pass_clean_files PASSED [  7%]
tests/test_audit_engine.py::TestSecretsScan::test_warn_on_hardcoded_password PASSED [  7%]
tests/test_audit_engine.py::TestSecretsScan::test_warn_on_aws_key PASSED [  7%]
tests/test_audit_engine.py::TestSecretsScan::test_skip_lockfiles PASSED  [  8%]
tests/test_audit_engine.py::TestPythonSyntax::test_pass_clean_python PASSED [  8%]
tests/test_audit_engine.py::TestPythonSyntax::test_fail_bad_python PASSED [  8%]
tests/test_audit_engine.py::TestRunAllChecks::test_returns_four_results PASSED [  8%]
tests/test_audit_runner.py::TestA1ScopeCompliance::test_pass_exact_match PASSED [  8%]
tests/test_audit_runner.py::TestA1ScopeCompliance::test_fail_unclaimed_file PASSED [  8%]
tests/test_audit_runner.py::TestA1ScopeCompliance::test_fail_phantom_file PASSED [  8%]
tests/test_audit_runner.py::TestA2MinimalDiff::test_pass_no_renames PASSED [  8%]
tests/test_audit_runner.py::TestA2MinimalDiff::test_fail_rename_detected PASSED [  9%]
tests/test_audit_runner.py::TestA3EvidenceCompleteness::test_pass_all_present PASSED [  9%]
tests/test_audit_runner.py::TestA3EvidenceCompleteness::test_fail_missing_test_runs PASSED [  9%]
tests/test_audit_runner.py::TestA3EvidenceCompleteness::test_fail_test_status_not_pass PASSED [  9%]
tests/test_audit_runner.py::TestA3EvidenceCompleteness::test_fail_empty_diff_log PASSED [  9%]
tests/test_audit_runner.py::TestA4BoundaryCompliance::test_pass_no_violations PASSED [  9%]
tests/test_audit_runner.py::TestA4BoundaryCompliance::test_fail_forbidden_pattern PASSED [  9%]
tests/test_audit_runner.py::TestA4BoundaryCompliance::test_pass_no_boundaries_file PASSED [ 10%]
tests/test_audit_runner.py::TestA5DiffLogGate::test_pass_no_todo PASSED  [ 10%]
tests/test_audit_runner.py::TestA5DiffLogGate::test_warn_has_todo PASSED [ 10%]
tests/test_audit_runner.py::TestA5DiffLogGate::test_fail_missing_file PASSED [ 10%]
tests/test_audit_runner.py::TestA5DiffLogGate::test_pass_todo_only_in_diff_hunks PASSED [ 10%]
tests/test_audit_runner.py::TestA6AuthorizationGate::test_pass_no_prior_authorized PASSED [ 10%]
tests/test_audit_runner.py::TestA6AuthorizationGate::test_pass_no_unauthorized_commits PASSED [ 10%]
tests/test_audit_runner.py::TestA7VerificationOrder::test_pass_correct_order PASSED [ 10%]
tests/test_audit_runner.py::TestA7VerificationOrder::test_fail_wrong_order PASSED [ 11%]
tests/test_audit_runner.py::TestA7VerificationOrder::test_fail_missing_keyword PASSED [ 11%]
tests/test_audit_runner.py::TestA8TestGate::test_pass_status_pass PASSED [ 11%]
tests/test_audit_runner.py::TestA8TestGate::test_fail_status_fail PASSED [ 11%]
tests/test_audit_runner.py::TestA8TestGate::test_fail_missing_file PASSED [ 11%]
tests/test_audit_runner.py::TestA9DependencyGate::test_pass_declared_dependency PASSED [ 11%]
tests/test_audit_runner.py::TestA9DependencyGate::test_fail_undeclared_dependency PASSED [ 11%]
tests/test_audit_runner.py::TestA9DependencyGate::test_pass_stdlib_import PASSED [ 12%]
tests/test_audit_runner.py::TestA9DependencyGate::test_pass_local_import PASSED [ 12%]
tests/test_audit_runner.py::TestA9DependencyGate::test_pass_no_forge_json PASSED [ 12%]
tests/test_audit_runner.py::TestW1SecretsInDiff::test_pass_no_secrets PASSED [ 12%]
tests/test_audit_runner.py::TestW1SecretsInDiff::test_warn_secret_pattern PASSED [ 12%]
tests/test_audit_runner.py::TestW2AuditLedgerIntegrity::test_pass_exists_non_empty PASSED [ 12%]
tests/test_audit_runner.py::TestW2AuditLedgerIntegrity::test_warn_missing PASSED [ 12%]
tests/test_audit_runner.py::TestW2AuditLedgerIntegrity::test_warn_empty PASSED [ 13%]
tests/test_audit_runner.py::TestW3PhysicsRouteCoverage::test_pass_all_covered PASSED [ 13%]
tests/test_audit_runner.py::TestW3PhysicsRouteCoverage::test_warn_uncovered_route PASSED [ 13%]
tests/test_audit_runner.py::TestW3PhysicsRouteCoverage::test_warn_no_physics PASSED [ 13%]
tests/test_audit_runner.py::TestRunAudit::test_run_audit_returns_structured_result PASSED [ 13%]
tests/test_audit_runner.py::TestRunAudit::test_run_audit_appends_ledger PASSED [ 13%]
tests/test_audit_runner.py::TestAuditRunEndpoint::test_audit_run_endpoint_requires_auth PASSED [ 13%]
tests/test_audit_runner.py::TestAuditRunEndpoint::test_audit_run_endpoint_returns_result PASSED [ 13%]
tests/test_audit_service.py::test_backfill_syncs_new_commits PASSED      [ 14%]
tests/test_audit_service.py::test_backfill_skips_all_existing PASSED     [ 14%]
tests/test_audit_service.py::test_backfill_raises_for_missing_repo PASSED [ 14%]
tests/test_audit_service.py::test_backfill_raises_for_wrong_user PASSED  [ 14%]
tests/test_audit_service.py::test_backfill_handles_commit_error_gracefully PASSED [ 14%]
tests/test_audit_service.py::test_backfill_cleans_stale_runs PASSED      [ 14%]
tests/test_audit_service.py::test_backfill_marks_error_on_cancel PASSED  [ 14%]
tests/test_auth.py::test_create_token_returns_string PASSED              [ 15%]
tests/test_auth.py::test_decode_token_returns_payload PASSED             [ 15%]
tests/test_auth.py::test_decode_token_rejects_invalid_token PASSED       [ 15%]
tests/test_auth.py::test_decode_token_rejects_wrong_secret PASSED        [ 15%]
tests/test_auth.py::test_decode_token_rejects_expired PASSED             [ 15%]
tests/test_auth_router.py::test_github_oauth_redirect_returns_url PASSED [ 15%]
tests/test_auth_router.py::test_github_callback_rejects_invalid_state PASSED [ 15%]
tests/test_auth_router.py::test_auth_me_returns_401_without_token PASSED [ 16%]
tests/test_auth_router.py::test_auth_me_returns_401_with_invalid_token PASSED [ 16%]
tests/test_auth_router.py::test_auth_me_returns_user_with_valid_token PASSED [ 16%]
tests/test_auth_router.py::test_auth_me_returns_401_when_user_not_found PASSED [ 16%]
tests/test_auth_router.py::test_save_api_key PASSED                      [ 16%]
tests/test_auth_router.py::test_save_api_key_empty_rejected PASSED       [ 16%]
tests/test_auth_router.py::test_remove_api_key PASSED                    [ 16%]
tests/test_auth_router.py::test_save_api_key_2 PASSED                    [ 16%]
tests/test_auth_router.py::test_remove_api_key_2 PASSED                  [ 17%]
tests/test_build_integration.py::TestFullBuildLifecycle::test_full_lifecycle_single_phase PASSED [ 17%]
tests/test_build_integration.py::TestFullBuildLifecycle::test_audit_failure_self_correction PASSED [ 17%]
tests/test_build_integration.py::TestFullBuildLifecycle::test_pause_threshold_then_user_retry PASSED [ 17%]
tests/test_build_integration.py::TestFullBuildLifecycle::test_pause_then_user_skip PASSED [ 17%]
tests/test_build_integration.py::TestFullBuildLifecycle::test_pause_then_user_abort PASSED [ 17%]
tests/test_build_integration.py::TestInterjection::test_interjection_injected_into_conversation PASSED [ 17%]
tests/test_build_integration.py::TestContextCompaction::test_compaction_triggers_on_threshold PASSED [ 18%]
tests/test_build_integration.py::TestFileOverwrite::test_file_overwrite_same_path PASSED [ 18%]
tests/test_build_integration.py::TestBuildTargets::test_local_path_file_writing PASSED [ 18%]
tests/test_build_integration.py::TestBuildTargets::test_github_new_repo_target PASSED [ 18%]
tests/test_build_integration.py::TestMalformedBlocks::test_missing_end_delimiter PASSED [ 18%]
tests/test_build_integration.py::TestMalformedBlocks::test_empty_file_path PASSED [ 18%]
tests/test_build_integration.py::TestMalformedBlocks::test_valid_blocks_still_parsed PASSED [ 18%]
tests/test_build_integration.py::TestMalformedBlocks::test_multiple_valid_blocks PASSED [ 18%]
tests/test_build_integration.py::TestLargeFileWarning::test_large_file_logs_warning PASSED [ 19%]
tests/test_build_integration.py::TestGitPushRetry::test_push_retries_on_failure PASSED [ 19%]
tests/test_build_integration.py::TestWorkingDirCleanup::test_github_target_cleaned_on_failure PASSED [ 19%]
tests/test_build_integration.py::TestObservability::test_build_summary_includes_stats PASSED [ 19%]
tests/test_build_integration.py::TestSearchableLogs::test_get_build_logs_with_search PASSED [ 19%]
tests/test_build_integration.py::TestConfigDefaults::test_phase_timeout_default PASSED [ 19%]
tests/test_build_integration.py::TestConfigDefaults::test_large_file_warn_default PASSED [ 19%]
tests/test_build_integration.py::TestConfigDefaults::test_git_push_max_retries_default PASSED [ 20%]
tests/test_build_repo.py::test_create_build PASSED                       [ 20%]
tests/test_build_repo.py::test_get_build_by_id PASSED                    [ 20%]
tests/test_build_repo.py::test_get_build_by_id_not_found PASSED          [ 20%]
tests/test_build_repo.py::test_get_latest_build_for_project PASSED       [ 20%]
tests/test_build_repo.py::test_update_build_status PASSED                [ 20%]
tests/test_build_repo.py::test_increment_loop_count PASSED               [ 20%]
tests/test_build_repo.py::test_cancel_build PASSED                       [ 21%]
tests/test_build_repo.py::test_cancel_build_not_active PASSED            [ 21%]
tests/test_build_repo.py::test_append_build_log PASSED                   [ 21%]
tests/test_build_repo.py::test_get_build_logs PASSED                     [ 21%]
tests/test_build_repo.py::test_record_build_cost PASSED                  [ 21%]
tests/test_build_repo.py::test_get_build_costs PASSED                    [ 21%]
tests/test_build_repo.py::test_get_build_cost_summary PASSED             [ 21%]
tests/test_build_repo.py::test_get_build_file_logs PASSED                [ 21%]
tests/test_build_repo.py::test_get_build_file_logs_invalid_json PASSED   [ 22%]
tests/test_build_repo.py::test_get_build_file_logs_empty PASSED          [ 22%]
tests/test_build_repo.py::test_create_build_with_target PASSED           [ 22%]
tests/test_build_repo.py::test_pause_build_success PASSED                [ 22%]
tests/test_build_repo.py::test_pause_build_not_running PASSED            [ 22%]
tests/test_build_repo.py::test_resume_build_success PASSED               [ 22%]
tests/test_build_repo.py::test_resume_build_not_paused PASSED            [ 22%]
tests/test_build_repo.py::test_cancel_build_includes_paused PASSED       [ 23%]
tests/test_build_repo.py::test_create_build_with_branch PASSED           [ 23%]
tests/test_build_repo.py::test_create_build_default_branch PASSED        [ 23%]
tests/test_build_repo.py::test_get_builds_for_project PASSED             [ 23%]
tests/test_build_repo.py::test_get_builds_for_project_empty PASSED       [ 23%]
tests/test_build_service.py::test_start_build_success PASSED             [ 23%]
tests/test_build_service.py::test_start_build_project_not_found PASSED   [ 23%]
tests/test_build_service.py::test_start_build_wrong_owner PASSED         [ 24%]
tests/test_build_service.py::test_start_build_no_contracts PASSED        [ 24%]
tests/test_build_service.py::test_start_build_with_snapshot_batch PASSED [ 24%]
tests/test_build_service.py::test_start_build_snapshot_batch_not_found PASSED [ 24%]
tests/test_build_service.py::test_start_build_already_running PASSED     [ 24%]
tests/test_build_service.py::test_start_build_no_api_key PASSED          [ 24%]
tests/test_build_service.py::test_cancel_build_success PASSED            [ 24%]
tests/test_build_service.py::test_cancel_build_no_active PASSED          [ 24%]
tests/test_build_service.py::test_get_build_status PASSED                [ 25%]
tests/test_build_service.py::test_get_build_status_no_builds PASSED      [ 25%]
tests/test_build_service.py::test_get_build_logs PASSED                  [ 25%]
tests/test_build_service.py::test_build_directive_format PASSED          [ 25%]
tests/test_build_service.py::test_build_directive_excludes_phases PASSED [ 25%]
tests/test_build_service.py::test_write_contracts_to_workdir PASSED      [ 25%]
tests/test_build_service.py::test_extract_phase_window_current_and_next PASSED [ 25%]
tests/test_build_service.py::test_extract_phase_window_last_phase PASSED [ 26%]
tests/test_build_service.py::test_extract_phase_window_no_phases_contract PASSED [ 26%]
tests/test_build_service.py::test_run_inline_audit PASSED                [ 26%]
tests/test_build_service.py::test_run_inline_audit_enabled_no_prompt PASSED [ 26%]
tests/test_build_service.py::test_audit_single_file_disabled PASSED      [ 26%]
tests/test_build_service.py::test_audit_single_file_trivially_small PASSED [ 26%]
tests/test_build_service.py::test_audit_single_file_clean PASSED         [ 26%]
tests/test_build_service.py::test_audit_single_file_flags_found PASSED   [ 27%]
tests/test_build_service.py::test_audit_single_file_llm_error_failopen PASSED [ 27%]
tests/test_build_service.py::test_audit_single_file_timeout_failopen PASSED [ 27%]
tests/test_build_service.py::test_fail_build PASSED                      [ 27%]
tests/test_build_service.py::test_get_build_summary PASSED               [ 27%]
tests/test_build_service.py::test_get_build_summary_not_found PASSED     [ 27%]
tests/test_build_service.py::test_get_build_instructions PASSED          [ 27%]
tests/test_build_service.py::test_get_build_instructions_no_contracts PASSED [ 27%]
tests/test_build_service.py::test_generate_deploy_instructions_full_stack PASSED [ 28%]
tests/test_build_service.py::test_generate_deploy_instructions_minimal PASSED [ 28%]
tests/test_build_service.py::test_record_phase_cost PASSED               [ 28%]
tests/test_build_service.py::test_get_token_rates_model_aware PASSED     [ 28%]
tests/test_build_service.py::test_detect_language_python PASSED          [ 28%]
tests/test_build_service.py::test_detect_language_typescript PASSED      [ 28%]
tests/test_build_service.py::test_detect_language_json PASSED            [ 28%]
tests/test_build_service.py::test_detect_language_unknown PASSED         [ 29%]
tests/test_build_service.py::test_detect_language_dotenv PASSED          [ 29%]
tests/test_build_service.py::test_detect_language_gitignore PASSED       [ 29%]
tests/test_build_service.py::test_parse_file_blocks_single PASSED        [ 29%]
tests/test_build_service.py::test_parse_file_blocks_multiple PASSED      [ 29%]
tests/test_build_service.py::test_parse_file_blocks_with_code_fence PASSED [ 29%]
tests/test_build_service.py::test_parse_file_blocks_no_end_marker PASSED [ 29%]
tests/test_build_service.py::test_parse_file_blocks_empty_input PASSED   [ 29%]
tests/test_build_service.py::test_strip_code_fence_basic PASSED          [ 30%]
tests/test_build_service.py::test_strip_code_fence_no_fence PASSED       [ 30%]
tests/test_build_service.py::test_strip_code_fence_empty PASSED          [ 30%]
tests/test_build_service.py::test_write_file_block_success PASSED        [ 30%]
tests/test_build_service.py::test_write_file_block_traversal_rejected PASSED [ 30%]
tests/test_build_service.py::test_write_file_block_absolute_rejected PASSED [ 30%]
tests/test_build_service.py::test_get_build_files PASSED                 [ 30%]
tests/test_build_service.py::test_get_build_files_no_project PASSED      [ 31%]
tests/test_build_service.py::test_get_build_file_content PASSED          [ 31%]
tests/test_build_service.py::test_get_build_file_content_traversal PASSED [ 31%]
tests/test_build_service.py::test_get_build_file_content_not_found PASSED [ 31%]
tests/test_build_service.py::test_start_build_invalid_target_type PASSED [ 31%]
tests/test_build_service.py::test_start_build_target_type_without_ref PASSED [ 31%]
tests/test_build_service.py::test_parse_build_plan_numbered PASSED       [ 31%]
tests/test_build_service.py::test_parse_build_plan_dash_list PASSED      [ 32%]
tests/test_build_service.py::test_parse_build_plan_no_plan PASSED        [ 32%]
tests/test_build_service.py::test_parse_build_plan_no_end PASSED         [ 32%]
tests/test_build_service.py::test_parse_build_plan_empty_lines PASSED    [ 32%]
tests/test_build_service.py::test_compact_conversation_short PASSED      [ 32%]
tests/test_build_service.py::test_compact_conversation_compacts_middle PASSED [ 32%]
tests/test_build_service.py::test_compact_conversation_truncates_long_content PASSED [ 32%]
tests/test_build_service.py::test_run_build_multi_turn_plan_detected PASSED [ 32%]
tests/test_build_service.py::test_run_build_multi_turn_audit_feedback PASSED [ 33%]
tests/test_build_service.py::test_run_build_multi_turn_max_failures PASSED [ 33%]
tests/test_build_service.py::test_run_build_turn_event_broadcast PASSED  [ 33%]
tests/test_build_service.py::test_run_build_task_done_broadcast PASSED   [ 33%]
tests/test_build_service.py::test_run_build_context_compaction PASSED    [ 33%]
tests/test_build_service.py::test_run_build_pauses_at_threshold PASSED   [ 33%]
tests/test_build_service.py::test_run_build_pause_resume_retry PASSED    [ 33%]
tests/test_build_service.py::test_run_build_pause_skip PASSED            [ 34%]
tests/test_build_service.py::test_run_build_interjection_injected PASSED [ 34%]
tests/test_build_service.py::test_resume_build_success PASSED            [ 34%]
tests/test_build_service.py::test_resume_build_not_resumable PASSED      [ 34%]
tests/test_build_service.py::test_resume_build_invalid_action PASSED     [ 34%]
tests/test_build_service.py::test_interject_build_success PASSED         [ 34%]
tests/test_build_service.py::test_interject_build_no_active PASSED       [ 34%]
tests/test_build_service.py::test_interject_build_no_queue PASSED        [ 35%]
tests/test_build_service.py::test_cancel_paused_build PASSED             [ 35%]
tests/test_build_service.py::test_pause_build_helper PASSED              [ 35%]
tests/test_build_service.py::test_pause_threshold_default PASSED         [ 35%]
tests/test_build_service.py::test_build_pause_timeout_default PASSED     [ 35%]
tests/test_build_service.py::test_plan_tasks_reset_between_phases PASSED [ 35%]
tests/test_build_service.py::test_build_overview_emitted PASSED          [ 35%]
tests/test_build_service.py::test_no_haiku_references_in_pricing PASSED  [ 35%]
tests/test_build_service.py::test_gather_project_state_empty_dir PASSED  [ 36%]
tests/test_build_service.py::test_gather_project_state_with_files PASSED [ 36%]
tests/test_build_service.py::test_gather_project_state_truncates_large_file PASSED [ 36%]
tests/test_build_service.py::test_gather_project_state_skips_pycache PASSED [ 36%]
tests/test_build_service.py::test_gather_project_state_none PASSED       [ 36%]
tests/test_build_service.py::test_run_recovery_planner_success PASSED    [ 36%]
tests/test_build_service.py::test_run_recovery_planner_missing_prompt PASSED [ 36%]
tests/test_build_service.py::test_recovery_planner_fallback_on_error PASSED [ 37%]
tests/test_build_service.py::test_recovery_planner_injects_remediation PASSED [ 37%]
tests/test_build_service.py::test_run_build_tool_call_execution PASSED   [ 37%]
tests/test_build_service.py::test_run_build_write_file_tool_emits_file_created PASSED [ 37%]
tests/test_build_service.py::test_run_build_tool_result_in_messages PASSED [ 37%]
tests/test_build_service.py::test_list_builds_success PASSED             [ 37%]
tests/test_build_service.py::test_list_builds_not_found PASSED           [ 37%]
tests/test_build_service.py::test_list_builds_wrong_user PASSED          [ 37%]
tests/test_build_service.py::test_start_build_with_branch PASSED         [ 38%]
tests/test_build_service.py::test_delete_builds_success PASSED           [ 38%]
tests/test_build_service.py::test_delete_builds_skips_active PASSED      [ 38%]
tests/test_build_service.py::test_delete_builds_all_active_raises PASSED [ 38%]
tests/test_build_service.py::test_delete_builds_not_found PASSED         [ 38%]
tests/test_build_service.py::test_delete_builds_empty_ids PASSED         [ 38%]
tests/test_build_service.py::test_pull_command_detects_phase PASSED      [ 38%]
tests/test_build_service.py::test_pull_command_no_repo PASSED            [ 39%]
tests/test_build_service.py::test_pull_command_no_token PASSED           [ 39%]
tests/test_build_service.py::test_pull_command_no_phases_starts_fresh PASSED [ 39%]
tests/test_build_service.py::test_manifest_cache_save_and_load PASSED    [ 39%]
tests/test_build_service.py::test_fix_single_file_applies_fix PASSED     [ 39%]
tests/test_build_service.py::test_audit_and_cache_fix_loop_passes_after_fix PASSED [ 39%]
tests/test_build_service.py::test_audit_and_cache_pushes_to_fix_queue PASSED [ 39%]
tests/test_build_service.py::test_builder_drain_fix_queue PASSED         [ 40%]
tests/test_build_service.py::test_audit_and_cache_skips_fix_when_pass PASSED [ 40%]
tests/test_builds_router.py::test_start_build PASSED                     [ 40%]
tests/test_builds_router.py::test_start_build_with_contract_batch PASSED [ 40%]
tests/test_builds_router.py::test_start_build_snapshot_batch_not_found PASSED [ 40%]
tests/test_builds_router.py::test_start_build_not_found PASSED           [ 40%]
tests/test_builds_router.py::test_start_build_no_contracts PASSED        [ 40%]
tests/test_builds_router.py::test_start_build_already_running PASSED     [ 40%]
tests/test_builds_router.py::test_cancel_build PASSED                    [ 41%]
tests/test_builds_router.py::test_cancel_build_no_active PASSED          [ 41%]
tests/test_builds_router.py::test_get_build_status PASSED                [ 41%]
tests/test_builds_router.py::test_get_build_status_no_builds PASSED      [ 41%]
tests/test_builds_router.py::test_get_build_logs PASSED                  [ 41%]
tests/test_builds_router.py::test_get_build_logs_not_found PASSED        [ 41%]
tests/test_builds_router.py::test_build_endpoints_require_auth PASSED    [ 41%]
tests/test_builds_router.py::test_get_build_summary PASSED               [ 42%]
tests/test_builds_router.py::test_get_build_summary_not_found PASSED     [ 42%]
tests/test_builds_router.py::test_get_build_instructions PASSED          [ 42%]
tests/test_builds_router.py::test_get_build_instructions_not_found PASSED [ 42%]
tests/test_builds_router.py::test_start_build_rate_limited PASSED        [ 42%]
tests/test_builds_router.py::test_start_build_with_target PASSED         [ 42%]
tests/test_builds_router.py::test_start_build_with_github_target PASSED  [ 42%]
tests/test_builds_router.py::test_get_build_files PASSED                 [ 43%]
tests/test_builds_router.py::test_get_build_files_not_found PASSED       [ 43%]
tests/test_builds_router.py::test_get_build_file_content PASSED          [ 43%]
tests/test_builds_router.py::test_get_build_file_content_not_found PASSED [ 43%]
tests/test_builds_router.py::test_resume_build PASSED                    [ 43%]
tests/test_builds_router.py::test_resume_build_not_paused PASSED         [ 43%]
tests/test_builds_router.py::test_resume_build_skip PASSED               [ 43%]
tests/test_builds_router.py::test_resume_build_abort PASSED              [ 43%]
tests/test_builds_router.py::test_interject_build PASSED                 [ 44%]
tests/test_builds_router.py::test_interject_build_no_active PASSED       [ 44%]
tests/test_builds_router.py::test_interject_build_not_found PASSED       [ 44%]
tests/test_builds_router.py::test_list_builds PASSED                     [ 44%]
tests/test_builds_router.py::test_list_builds_not_found PASSED           [ 44%]
tests/test_builds_router.py::test_list_builds_empty PASSED               [ 44%]
tests/test_builds_router.py::test_start_build_with_branch PASSED         [ 44%]
tests/test_builds_router.py::test_start_build_default_branch PASSED      [ 45%]
tests/test_builds_router.py::test_delete_builds_success PASSED           [ 45%]
tests/test_builds_router.py::test_delete_builds_not_found PASSED         [ 45%]
tests/test_builds_router.py::test_delete_builds_no_eligible PASSED       [ 45%]
tests/test_config.py::test_config_loads_with_env_vars PASSED             [ 45%]
tests/test_config.py::test_config_has_default_urls PASSED                [ 45%]
tests/test_config.py::test_config_settings_type PASSED                   [ 45%]
tests/test_config.py::test_config_has_tpm_settings PASSED                [ 45%]
tests/test_config.py::test_config_has_builder_max_tokens PASSED          [ 46%]
tests/test_contract_snapshots.py::test_list_history_empty PASSED         [ 46%]
tests/test_contract_snapshots.py::test_list_history_with_batches PASSED  [ 46%]
tests/test_contract_snapshots.py::test_list_history_project_not_found PASSED [ 46%]
tests/test_contract_snapshots.py::test_list_history_wrong_user PASSED    [ 46%]
tests/test_contract_snapshots.py::test_get_batch_contracts PASSED        [ 46%]
tests/test_contract_snapshots.py::test_get_batch_not_found PASSED        [ 46%]
tests/test_contract_snapshots.py::test_get_batch_wrong_user PASSED       [ 47%]
tests/test_contract_snapshots.py::test_list_versions_delegates_to_repo PASSED [ 47%]
tests/test_contract_snapshots.py::test_get_version_delegates_to_repo PASSED [ 47%]
tests/test_contract_snapshots.py::test_generate_snapshots_before_regeneration PASSED [ 47%]
tests/test_contract_snapshots.py::test_generate_no_snapshot_for_first_generation PASSED [ 47%]
tests/test_contract_snapshots.py::test_history_requires_auth PASSED      [ 47%]
tests/test_cost_gate.py::test_init_cost_tracking PASSED                  [ 47%]
tests/test_cost_gate.py::test_cleanup_cost_tracking PASSED               [ 48%]
tests/test_cost_gate.py::test_accumulate_cost_tracks_running_total PASSED [ 48%]
tests/test_cost_gate.py::test_cost_gate_no_cap_unlimited PASSED          [ 48%]
tests/test_cost_gate.py::test_cost_gate_user_cap_exceeded PASSED         [ 48%]
tests/test_cost_gate.py::test_cost_gate_server_cap_used_when_no_user_cap PASSED [ 48%]
tests/test_cost_gate.py::test_cost_gate_warning_at_threshold PASSED      [ 48%]
tests/test_cost_gate.py::test_cost_gate_warning_sent_only_once PASSED    [ 48%]
tests/test_cost_gate.py::test_cost_gate_below_threshold_no_warning PASSED [ 48%]
tests/test_cost_gate.py::test_get_build_cost_live PASSED                 [ 49%]
tests/test_cost_gate.py::test_get_build_cost_live_empty PASSED           [ 49%]
tests/test_cost_gate.py::test_broadcast_cost_ticker PASSED               [ 49%]
tests/test_cost_gate.py::test_save_spend_cap PASSED                      [ 49%]
tests/test_cost_gate.py::test_save_spend_cap_rejects_zero PASSED         [ 49%]
tests/test_cost_gate.py::test_save_spend_cap_rejects_negative PASSED     [ 49%]
tests/test_cost_gate.py::test_remove_spend_cap PASSED                    [ 49%]
tests/test_cost_gate.py::test_me_includes_spend_cap PASSED               [ 50%]
tests/test_cost_gate.py::test_me_spend_cap_null_when_not_set PASSED      [ 50%]
tests/test_cost_gate.py::test_config_cost_defaults PASSED                [ 50%]
tests/test_git_client.py::test_run_git_success PASSED                    [ 50%]
tests/test_git_client.py::test_run_git_failure PASSED                    [ 50%]
tests/test_git_client.py::test_init_repo PASSED                          [ 50%]
tests/test_git_client.py::test_add_all PASSED                            [ 50%]
tests/test_git_client.py::test_commit PASSED                             [ 51%]
tests/test_git_client.py::test_clone_repo PASSED                         [ 51%]
tests/test_git_client.py::test_push PASSED                               [ 51%]
tests/test_git_client.py::test_set_remote PASSED                         [ 51%]
tests/test_git_client.py::test_get_file_list PASSED                      [ 51%]
tests/test_git_client.py::test_get_file_list_empty PASSED                [ 51%]
tests/test_git_client.py::test_create_branch PASSED                      [ 51%]
tests/test_git_client.py::test_checkout_branch PASSED                    [ 51%]
tests/test_git_client.py::test_diff_summary PASSED                       [ 52%]
tests/test_git_client.py::test_diff_summary_single_commit PASSED         [ 52%]
tests/test_git_client.py::test_log_oneline PASSED                        [ 52%]
tests/test_git_client.py::test_log_oneline_empty PASSED                  [ 52%]
tests/test_github_client.py::test_list_commits_returns_commits PASSED    [ 52%]
tests/test_github_client.py::test_list_commits_empty_repo PASSED         [ 52%]
tests/test_github_client.py::test_list_commits_passes_since_param PASSED [ 52%]
tests/test_github_client.py::test_create_github_repo_returns_repo_info PASSED [ 53%]
tests/test_governance_gate.py::TestGovernanceAllPass::test_all_checks_pass PASSED [ 53%]
tests/test_governance_gate.py::TestG1ScopeCompliance::test_phantom_file_detected PASSED [ 53%]
tests/test_governance_gate.py::TestG1ScopeCompliance::test_missing_file_detected PASSED [ 53%]
tests/test_governance_gate.py::TestG2BoundaryCompliance::test_boundary_violation_detected PASSED [ 53%]
tests/test_governance_gate.py::TestG2BoundaryCompliance::test_no_boundary_violation PASSED [ 53%]
tests/test_governance_gate.py::TestG3DependencyGate::test_undeclared_dependency_detected PASSED [ 53%]
tests/test_governance_gate.py::TestG3DependencyGate::test_declared_dependency_passes PASSED [ 54%]
tests/test_governance_gate.py::TestG4SecretsScan::test_secret_pattern_detected PASSED [ 54%]
tests/test_governance_gate.py::TestG4SecretsScan::test_no_secrets PASSED [ 54%]
tests/test_governance_gate.py::TestG7TodoScan::test_todo_detected PASSED [ 54%]
tests/test_governance_gate.py::TestG7TodoScan::test_not_implemented_error_detected PASSED [ 54%]
tests/test_governance_gate.py::TestGovernanceBlockingVsWarnings::test_blocking_failure_sets_passed_false PASSED [ 54%]
tests/test_governance_gate.py::TestGovernanceBlockingVsWarnings::test_warn_only_still_passes PASSED [ 54%]
tests/test_governance_gate.py::TestGovernanceCheckCount::test_always_returns_seven_checks PASSED [ 54%]
tests/test_hardening.py::test_webhook_rate_limit_blocks_excess PASSED    [ 55%]
tests/test_hardening.py::test_connect_repo_rejects_invalid_full_name PASSED [ 55%]
tests/test_hardening.py::test_connect_repo_rejects_zero_id PASSED        [ 55%]
tests/test_hardening.py::test_connect_repo_rejects_empty_branch PASSED   [ 55%]
tests/test_hardening.py::test_connect_repo_accepts_valid_input PASSED    [ 55%]
tests/test_hardening.py::test_global_error_handler_is_registered PASSED  [ 55%]
tests/test_hardening.py::test_cors_allows_valid_origin FAILED            [ 55%]
tests/test_health.py::test_health_returns_ok PASSED                      [ 56%]
tests/test_health.py::test_health_version_returns_version PASSED         [ 56%]
tests/test_llm_client.py::test_chat_success PASSED                       [ 56%]
tests/test_llm_client.py::test_chat_empty_content PASSED                 [ 56%]
tests/test_llm_client.py::test_chat_no_text_block PASSED                 [ 56%]
tests/test_llm_client.py::test_chat_sends_correct_headers PASSED         [ 56%]
tests/test_llm_client.py::test_chat_max_tokens_parameter PASSED          [ 56%]
tests/test_llm_client.py::test_chat_openai_success PASSED                [ 56%]
tests/test_llm_client.py::test_chat_openai_empty_choices PASSED          [ 57%]
tests/test_llm_client.py::test_chat_openai_no_content PASSED             [ 57%]
tests/test_llm_client.py::test_chat_openai_sends_correct_headers PASSED  [ 57%]
tests/test_llm_client.py::test_chat_dispatches_to_openai PASSED          [ 57%]
tests/test_llm_client.py::test_chat_defaults_to_anthropic PASSED         [ 57%]
tests/test_llm_client.py::TestRetryOnTransient::test_no_retry_on_success PASSED [ 57%]
tests/test_llm_client.py::TestRetryOnTransient::test_retries_on_timeout PASSED [ 57%]
tests/test_llm_client.py::TestRetryOnTransient::test_exhausts_retries_on_timeout PASSED [ 58%]
tests/test_llm_client.py::TestRetryOnTransient::test_retries_on_429 PASSED [ 58%]
tests/test_llm_client.py::TestRetryOnTransient::test_retries_on_529 PASSED [ 58%]
tests/test_llm_client.py::TestRetryOnTransient::test_no_retry_on_400 PASSED [ 58%]
tests/test_llm_client.py::TestRetryOnTransient::test_retries_on_anthropic_429_valueerror PASSED [ 58%]
tests/test_llm_client.py::TestRetryOnTransient::test_no_retry_on_non_retryable_valueerror PASSED [ 58%]
tests/test_llm_client.py::TestRetryOnTransient::test_exponential_backoff PASSED [ 58%]
tests/test_llm_client.py::test_anthropic_timeout_is_300s PASSED          [ 59%]
tests/test_llm_client.py::test_openai_timeout_is_300s PASSED             [ 59%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_clean_project_few_migrations PASSED [ 59%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_js_to_ts_migration PASSED [ 59%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_add_tests_migration PASSED [ 59%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_add_ci_migration PASSED [ 59%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_add_docker_migration PASSED [ 59%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_outdated_upgrade PASSED [ 59%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_eol_replacement PASSED [ 60%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_secrets_migration PASSED [ 60%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_recommendations_sorted_by_priority PASSED [ 60%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_recommendation_structure PASSED [ 60%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_empty_inputs PASSED [ 60%]
tests/test_migration_advisor.py::TestRecommendMigrations::test_forge_automatable_flag PASSED [ 60%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_clean_project_no_findings PASSED [ 60%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detects_no_typescript PASSED [ 61%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detects_no_tests PASSED [ 61%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detects_no_ci PASSED [ 61%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detects_no_docker PASSED [ 61%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detects_secrets_in_code PASSED [ 61%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detects_no_readme PASSED [ 61%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detects_no_license PASSED [ 61%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_findings_sorted_by_severity PASSED [ 62%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_empty_inputs PASSED [ 62%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_finding_structure PASSED [ 62%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detects_unpinned_deps PASSED [ 62%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_detector_isolation PASSED [ 62%]
tests/test_pattern_analyzer.py::TestAnalyzePatterns::test_class_components_detected PASSED [ 62%]
tests/test_plan_execute.py::TestSelectContractsForFile::test_app_file_gets_backend_contracts PASSED [ 62%]
tests/test_plan_execute.py::TestSelectContractsForFile::test_test_file_gets_test_contracts PASSED [ 62%]
tests/test_plan_execute.py::TestSelectContractsForFile::test_frontend_file_gets_ui_contract PASSED [ 63%]
tests/test_plan_execute.py::TestSelectContractsForFile::test_sql_file_only_gets_schema PASSED [ 63%]
tests/test_plan_execute.py::TestSelectContractsForFile::test_unknown_path_gets_fallback PASSED [ 63%]
tests/test_plan_execute.py::TestSelectContractsForFile::test_empty_contracts_returns_empty PASSED [ 63%]
tests/test_plan_execute.py::TestCalculateContextBudget::test_basic_budget PASSED [ 63%]
tests/test_plan_execute.py::TestCalculateContextBudget::test_max_tokens_scales_with_lines PASSED [ 63%]
tests/test_plan_execute.py::TestCalculateContextBudget::test_max_tokens_capped PASSED [ 63%]
tests/test_plan_execute.py::TestCalculateContextBudget::test_depends_on_prioritized PASSED [ 64%]
tests/test_plan_execute.py::TestCalculateContextBudget::test_missing_context_files_skipped PASSED [ 64%]
tests/test_plan_execute.py::TestTopologicalSort::test_simple_dependency PASSED [ 64%]
tests/test_plan_execute.py::TestTopologicalSort::test_no_dependencies PASSED [ 64%]
tests/test_plan_execute.py::TestTopologicalSort::test_circular_dependency_fallback PASSED [ 64%]
tests/test_plan_execute.py::TestTopologicalSort::test_chain_dependency PASSED [ 64%]
tests/test_plan_execute.py::TestGenerateFileManifest::test_successful_manifest PASSED [ 64%]
tests/test_plan_execute.py::TestGenerateFileManifest::test_manifest_with_fences PASSED [ 64%]
tests/test_plan_execute.py::TestGenerateFileManifest::test_manifest_filters_invalid_paths PASSED [ 65%]
tests/test_plan_execute.py::TestGenerateFileManifest::test_manifest_deduplicates PASSED [ 65%]
tests/test_plan_execute.py::TestGenerateSingleFile::test_generates_file_content PASSED [ 65%]
tests/test_plan_execute.py::TestGenerateSingleFile::test_strips_markdown_fences PASSED [ 65%]
tests/test_plan_execute.py::TestGenerateSingleFile::test_records_cost PASSED [ 65%]
tests/test_plan_execute.py::TestGenerateFixManifest::test_generates_fix_list PASSED [ 65%]
tests/test_plan_execute.py::TestGenerateFixManifest::test_handles_invalid_json PASSED [ 65%]
tests/test_plan_execute.py::TestBuildModeDispatcher::test_plan_execute_mode PASSED [ 66%]
tests/test_plan_execute.py::TestBuildModeDispatcher::test_conversation_mode PASSED [ 66%]
tests/test_plan_execute.py::TestBuildModeDispatcher::test_plan_execute_without_working_dir_falls_back PASSED [ 66%]
tests/test_plan_execute.py::TestVerifyPhaseOutput::test_clean_verification PASSED [ 66%]
tests/test_plan_execute.py::TestVerifyPhaseOutput::test_syntax_error_detected PASSED [ 66%]
tests/test_project_service.py::test_parse_valid_json PASSED              [ 66%]
tests/test_project_service.py::test_parse_json_with_code_fences PASSED   [ 66%]
tests/test_project_service.py::test_parse_fallback_plain_text PASSED     [ 67%]
tests/test_project_service.py::test_parse_invalid_json PASSED            [ 67%]
tests/test_project_service.py::test_progress_empty PASSED                [ 67%]
tests/test_project_service.py::test_progress_partial PASSED              [ 67%]
tests/test_project_service.py::test_progress_complete PASSED             [ 67%]
tests/test_project_service.py::test_create_new_project PASSED            [ 67%]
tests/test_project_service.py::test_process_questionnaire_first_message PASSED [ 67%]
tests/test_project_service.py::test_process_questionnaire_not_found PASSED [ 67%]
tests/test_project_service.py::test_process_questionnaire_wrong_user PASSED [ 68%]
tests/test_project_service.py::test_process_questionnaire_already_complete PASSED [ 68%]
tests/test_project_service.py::test_generate_contracts_success PASSED    [ 68%]
tests/test_project_service.py::test_generate_contracts_incomplete PASSED [ 68%]
tests/test_project_service.py::test_cancel_contract_generation_no_active PASSED [ 68%]
tests/test_project_service.py::test_cancel_contract_generation_success PASSED [ 68%]
tests/test_project_service.py::test_generate_contracts_cancelled_mid_generation PASSED [ 68%]
tests/test_project_service.py::test_get_questionnaire_state PASSED       [ 69%]
tests/test_project_service.py::test_update_contract_invalid_type PASSED  [ 69%]
tests/test_projects_router.py::test_create_project PASSED                [ 69%]
tests/test_projects_router.py::test_create_project_with_repo_id PASSED   [ 69%]
tests/test_projects_router.py::test_create_project_with_local_path PASSED [ 69%]
tests/test_projects_router.py::test_create_project_missing_name PASSED   [ 69%]
tests/test_projects_router.py::test_create_project_unauthenticated PASSED [ 69%]
tests/test_projects_router.py::test_list_projects PASSED                 [ 70%]
tests/test_projects_router.py::test_get_project_detail PASSED            [ 70%]
tests/test_projects_router.py::test_get_project_not_found PASSED         [ 70%]
tests/test_projects_router.py::test_delete_project PASSED                [ 70%]
tests/test_projects_router.py::test_questionnaire_message PASSED         [ 70%]
tests/test_projects_router.py::test_questionnaire_project_not_found PASSED [ 70%]
tests/test_projects_router.py::test_questionnaire_state PASSED           [ 70%]
tests/test_projects_router.py::test_generate_contracts_incomplete PASSED [ 70%]
tests/test_projects_router.py::test_generate_contracts_success PASSED    [ 71%]
tests/test_projects_router.py::test_cancel_contracts_no_active PASSED    [ 71%]
tests/test_projects_router.py::test_list_contracts PASSED                [ 71%]
tests/test_projects_router.py::test_get_contract PASSED                  [ 71%]
tests/test_projects_router.py::test_get_contract_not_found PASSED        [ 71%]
tests/test_projects_router.py::test_update_contract PASSED               [ 71%]
tests/test_projects_router.py::test_update_contract_invalid_type PASSED  [ 71%]
tests/test_rate_limit.py::test_allows_within_limit PASSED                [ 72%]
tests/test_rate_limit.py::test_blocks_over_limit PASSED                  [ 72%]
tests/test_rate_limit.py::test_separate_keys PASSED                      [ 72%]
tests/test_rate_limit.py::test_window_expiry PASSED                      [ 72%]
tests/test_repo_health.py::test_health_green_all_pass PASSED             [ 72%]
tests/test_repo_health.py::test_health_red_low_pass PASSED               [ 72%]
tests/test_repo_health.py::test_health_yellow_mixed PASSED               [ 72%]
tests/test_repo_health.py::test_health_pending_no_audits PASSED          [ 72%]
tests/test_repos_router.py::test_list_repos_returns_items PASSED         [ 73%]
tests/test_repos_router.py::test_list_repos_empty PASSED                 [ 73%]
tests/test_repos_router.py::test_list_repos_requires_auth PASSED         [ 73%]
tests/test_repos_router.py::test_list_available_repos PASSED             [ 73%]
tests/test_repos_router.py::test_connect_repo_success PASSED             [ 73%]
tests/test_repos_router.py::test_connect_repo_already_connected PASSED   [ 73%]
tests/test_repos_router.py::test_connect_repo_requires_auth PASSED       [ 73%]
tests/test_repos_router.py::test_disconnect_repo_success PASSED          [ 74%]
tests/test_repos_router.py::test_disconnect_repo_not_found PASSED        [ 74%]
tests/test_repos_router.py::test_disconnect_repo_requires_auth PASSED    [ 74%]
tests/test_repos_router.py::test_sync_commits_success PASSED             [ 74%]
tests/test_repos_router.py::test_sync_commits_not_found PASSED           [ 74%]
tests/test_repos_router.py::test_sync_commits_requires_auth PASSED       [ 74%]
tests/test_repos_router.py::test_create_repo_success PASSED              [ 74%]
tests/test_repos_router.py::test_create_repo_invalid_name PASSED         [ 75%]
tests/test_repos_router.py::test_create_repo_requires_auth PASSED        [ 75%]
tests/test_repos_router.py::test_list_all_repos PASSED                   [ 75%]
tests/test_repos_router.py::test_list_all_repos_requires_auth PASSED     [ 75%]
tests/test_scout_deep_scan.py::test_select_key_files_manifests_first PASSED [ 75%]
tests/test_scout_deep_scan.py::test_select_key_files_skips_large PASSED  [ 75%]
tests/test_scout_deep_scan.py::test_select_key_files_entry_points PASSED [ 75%]
tests/test_scout_deep_scan.py::test_select_key_files_router_files PASSED [ 75%]
tests/test_scout_deep_scan.py::test_select_key_files_cap PASSED          [ 76%]
tests/test_scout_deep_scan.py::test_select_key_files_migration_files PASSED [ 76%]
tests/test_scout_deep_scan.py::test_start_deep_scan_not_found PASSED     [ 76%]
tests/test_scout_deep_scan.py::test_start_deep_scan_wrong_user PASSED    [ 76%]
tests/test_scout_deep_scan.py::test_start_deep_scan_returns_running PASSED [ 76%]
tests/test_scout_deep_scan.py::test_get_scout_dossier_returns_data PASSED [ 76%]
tests/test_scout_deep_scan.py::test_get_scout_dossier_not_found PASSED   [ 76%]
tests/test_scout_deep_scan.py::test_get_scout_dossier_wrong_user PASSED  [ 77%]
tests/test_scout_deep_scan.py::test_get_scout_dossier_quick_scan_rejected PASSED [ 77%]
tests/test_scout_router.py::test_trigger_scout PASSED                    [ 77%]
tests/test_scout_router.py::test_trigger_scout_no_body PASSED            [ 77%]
tests/test_scout_router.py::test_trigger_scout_not_found PASSED          [ 77%]
tests/test_scout_router.py::test_trigger_scout_unauthenticated PASSED    [ 77%]
tests/test_scout_router.py::test_scout_history PASSED                    [ 77%]
tests/test_scout_router.py::test_scout_repo_history PASSED               [ 78%]
tests/test_scout_router.py::test_scout_run_detail PASSED                 [ 78%]
tests/test_scout_router.py::test_scout_run_detail_not_found PASSED       [ 78%]
tests/test_scout_service.py::test_build_check_list_all_pass PASSED       [ 78%]
tests/test_scout_service.py::test_build_check_list_engine_fail_propagated PASSED [ 78%]
tests/test_scout_service.py::test_build_check_list_no_evidence_warns PASSED [ 78%]
tests/test_scout_service.py::test_build_check_list_evidence_passes PASSED [ 78%]
tests/test_scout_service.py::test_start_scout_run_success PASSED         [ 78%]
tests/test_scout_service.py::test_start_scout_run_not_found PASSED       [ 79%]
tests/test_scout_service.py::test_start_scout_run_wrong_user PASSED      [ 79%]
tests/test_scout_service.py::test_get_history_all_repos PASSED           [ 79%]
tests/test_scout_service.py::test_get_history_single_repo PASSED         [ 79%]
tests/test_scout_service.py::test_get_detail_success PASSED              [ 79%]
tests/test_scout_service.py::test_get_detail_not_found PASSED            [ 79%]
tests/test_scout_service.py::test_get_detail_wrong_user PASSED           [ 79%]
tests/test_stack_detector.py::test_parse_requirements_simple PASSED      [ 80%]
tests/test_stack_detector.py::test_parse_requirements_comments_blanks PASSED [ 80%]
tests/test_stack_detector.py::test_parse_pyproject_deps PASSED           [ 80%]
tests/test_stack_detector.py::test_parse_pyproject_poetry PASSED         [ 80%]
tests/test_stack_detector.py::test_get_pkg_json_deps PASSED              [ 80%]
tests/test_stack_detector.py::test_detect_stack_fastapi_project PASSED   [ 80%]
tests/test_stack_detector.py::test_detect_stack_django_project PASSED    [ 80%]
tests/test_stack_detector.py::test_detect_stack_react_vite_project PASSED [ 81%]
tests/test_stack_detector.py::test_detect_stack_nextjs_fullstack PASSED  [ 81%]
tests/test_stack_detector.py::test_detect_stack_empty_repo PASSED        [ 81%]
tests/test_stack_detector.py::test_detect_stack_python_library PASSED    [ 81%]
tests/test_stack_detector.py::test_detect_stack_cli_app PASSED           [ 81%]
tests/test_stack_detector.py::test_detect_stack_monorepo PASSED          [ 81%]
tests/test_stack_detector.py::test_detect_stack_static_html PASSED       [ 81%]
tests/test_stack_detector.py::test_detect_stack_infrastructure_render PASSED [ 81%]
tests/test_stack_detector.py::test_detect_stack_language_percentages PASSED [ 82%]
tests/test_tool_executor.py::TestResolveSandboxed::test_valid_relative_path PASSED [ 82%]
tests/test_tool_executor.py::TestResolveSandboxed::test_rejects_absolute_path PASSED [ 82%]
tests/test_tool_executor.py::TestResolveSandboxed::test_rejects_windows_absolute_path PASSED [ 82%]
tests/test_tool_executor.py::TestResolveSandboxed::test_rejects_dot_dot_traversal PASSED [ 82%]
tests/test_tool_executor.py::TestResolveSandboxed::test_rejects_mid_path_dot_dot PASSED [ 82%]
tests/test_tool_executor.py::TestResolveSandboxed::test_rejects_empty_path PASSED [ 82%]
tests/test_tool_executor.py::TestResolveSandboxed::test_rejects_empty_working_dir PASSED [ 83%]
tests/test_tool_executor.py::TestResolveSandboxed::test_simple_filename PASSED [ 83%]
tests/test_tool_executor.py::TestResolveSandboxed::test_nested_path PASSED [ 83%]
tests/test_tool_executor.py::TestReadFile::test_read_existing_file PASSED [ 83%]
tests/test_tool_executor.py::TestReadFile::test_read_nested_file PASSED  [ 83%]
tests/test_tool_executor.py::TestReadFile::test_file_not_found PASSED    [ 83%]
tests/test_tool_executor.py::TestReadFile::test_path_traversal_blocked PASSED [ 83%]
tests/test_tool_executor.py::TestReadFile::test_truncation_at_limit PASSED [ 83%]
tests/test_tool_executor.py::TestReadFile::test_directory_not_a_file PASSED [ 84%]
tests/test_tool_executor.py::TestReadFile::test_empty_path PASSED        [ 84%]
tests/test_tool_executor.py::TestListDirectory::test_list_root PASSED    [ 84%]
tests/test_tool_executor.py::TestListDirectory::test_list_subdirectory PASSED [ 84%]
tests/test_tool_executor.py::TestListDirectory::test_skips_hidden_dirs PASSED [ 84%]
tests/test_tool_executor.py::TestListDirectory::test_empty_directory PASSED [ 84%]
tests/test_tool_executor.py::TestListDirectory::test_not_a_directory PASSED [ 84%]
tests/test_tool_executor.py::TestListDirectory::test_nonexistent_directory PASSED [ 85%]
tests/test_tool_executor.py::TestListDirectory::test_default_path_is_root PASSED [ 85%]
tests/test_tool_executor.py::TestSearchCode::test_literal_search PASSED  [ 85%]
tests/test_tool_executor.py::TestSearchCode::test_regex_search PASSED    [ 85%]
tests/test_tool_executor.py::TestSearchCode::test_glob_filter PASSED     [ 85%]
tests/test_tool_executor.py::TestSearchCode::test_no_results PASSED      [ 85%]
tests/test_tool_executor.py::TestSearchCode::test_empty_pattern_error PASSED [ 85%]
tests/test_tool_executor.py::TestSearchCode::test_skips_excluded_dirs PASSED [ 86%]
tests/test_tool_executor.py::TestSearchCode::test_invalid_regex_falls_back_to_literal PASSED [ 86%]
tests/test_tool_executor.py::TestSearchCode::test_case_insensitive PASSED [ 86%]
tests/test_tool_executor.py::TestWriteFile::test_write_new_file PASSED   [ 86%]
tests/test_tool_executor.py::TestWriteFile::test_write_creates_parent_dirs PASSED [ 86%]
tests/test_tool_executor.py::TestWriteFile::test_overwrite_existing_file PASSED [ 86%]
tests/test_tool_executor.py::TestWriteFile::test_rejects_path_traversal PASSED [ 86%]
tests/test_tool_executor.py::TestWriteFile::test_rejects_oversized_content PASSED [ 86%]
tests/test_tool_executor.py::TestWriteFile::test_reports_byte_count PASSED [ 87%]
tests/test_tool_executor.py::TestWriteFile::test_empty_content_writes_empty_file PASSED [ 87%]
tests/test_tool_executor.py::TestWriteFile::test_skip_duplicate_write PASSED [ 87%]
tests/test_tool_executor.py::TestWriteFile::test_overwrite_different_content PASSED [ 87%]
tests/test_tool_executor.py::TestExecuteTool::test_unknown_tool PASSED   [ 87%]
tests/test_tool_executor.py::TestExecuteTool::test_exception_in_handler_returns_error PASSED [ 87%]
tests/test_tool_executor.py::TestBuilderToolsSpec::test_has_seven_tools PASSED [ 87%]
tests/test_tool_executor.py::TestBuilderToolsSpec::test_tool_names PASSED [ 88%]
tests/test_tool_executor.py::TestBuilderToolsSpec::test_each_tool_has_required_fields PASSED [ 88%]
tests/test_tool_executor.py::TestSkipDirs::test_contains_common_dirs PASSED [ 88%]
tests/test_tool_executor.py::TestValidateCommand::test_allowed_test_command PASSED [ 88%]
tests/test_tool_executor.py::TestValidateCommand::test_allowed_npm_test PASSED [ 88%]
tests/test_tool_executor.py::TestValidateCommand::test_allowed_vitest PASSED [ 88%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_disallowed_test_command PASSED [ 88%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_empty_command PASSED [ 89%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_semicolon_injection PASSED [ 89%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_pipe_injection PASSED [ 89%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_backtick_injection PASSED [ 89%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_dollar_injection PASSED [ 89%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_ampersand_injection PASSED [ 89%]
tests/test_tool_executor.py::TestValidateCommand::test_allowed_pip_install PASSED [ 89%]
tests/test_tool_executor.py::TestValidateCommand::test_allowed_npm_install PASSED [ 89%]
tests/test_tool_executor.py::TestValidateCommand::test_allowed_cat PASSED [ 90%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_curl PASSED [ 90%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_wget PASSED [ 90%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_ssh PASSED [ 90%]
tests/test_tool_executor.py::TestValidateCommand::test_rejects_git_push PASSED [ 90%]
tests/test_tool_executor.py::TestExecuteToolAsync::test_sync_tool_via_async PASSED [ 90%]
tests/test_tool_executor.py::TestExecuteToolAsync::test_unknown_tool_async PASSED [ 90%]
tests/test_tool_executor.py::TestCheckSyntax::test_valid_python PASSED   [ 91%]
tests/test_tool_executor.py::TestCheckSyntax::test_invalid_python PASSED [ 91%]
tests/test_tool_executor.py::TestCheckSyntax::test_file_not_found PASSED [ 91%]
tests/test_tool_executor.py::TestCheckSyntax::test_path_traversal_blocked PASSED [ 91%]
tests/test_tool_executor.py::TestCheckSyntax::test_unsupported_extension PASSED [ 91%]
tests/test_tool_executor.py::TestRunTestsValidation::test_rejects_disallowed_command PASSED [ 91%]
tests/test_tool_executor.py::TestRunTestsValidation::test_rejects_injection PASSED [ 91%]
tests/test_tool_executor.py::TestRunTestsValidation::test_rejects_empty_command PASSED [ 91%]
tests/test_tool_executor.py::TestRunCommandValidation::test_rejects_disallowed_command PASSED [ 92%]
tests/test_tool_executor.py::TestRunCommandValidation::test_rejects_injection PASSED [ 92%]
tests/test_tool_executor.py::TestRunCommandValidation::test_rejects_git_push PASSED [ 92%]
tests/test_upgrade_service.py::TestExtractPythonDeps::test_extracts_framework PASSED [ 92%]
tests/test_upgrade_service.py::TestExtractPythonDeps::test_extracts_python_version PASSED [ 92%]
tests/test_upgrade_service.py::TestExtractPythonDeps::test_empty_stack PASSED [ 92%]
tests/test_upgrade_service.py::TestExtractNodeDeps::test_extracts_framework PASSED [ 92%]
tests/test_upgrade_service.py::TestExtractNodeDeps::test_extracts_bundler PASSED [ 93%]
tests/test_upgrade_service.py::TestExtractNodeDeps::test_empty_stack PASSED [ 93%]
tests/test_upgrade_service.py::TestGenerateForgeSpec::test_with_automatable_migrations PASSED [ 93%]
tests/test_upgrade_service.py::TestGenerateForgeSpec::test_no_automatable PASSED [ 93%]
tests/test_upgrade_service.py::TestGenerateForgeSpec::test_empty_migrations PASSED [ 93%]
tests/test_upgrade_service.py::TestGenerateRenovationPlan::test_successful_plan_generation PASSED [ 93%]
tests/test_upgrade_service.py::TestGenerateRenovationPlan::test_plan_summary_stats PASSED [ 93%]
tests/test_upgrade_service.py::TestGenerateRenovationPlan::test_rejects_non_deep_scan PASSED [ 94%]
tests/test_upgrade_service.py::TestGenerateRenovationPlan::test_rejects_incomplete_run PASSED [ 94%]
tests/test_upgrade_service.py::TestGenerateRenovationPlan::test_rejects_wrong_user PASSED [ 94%]
tests/test_upgrade_service.py::TestGenerateRenovationPlan::test_persists_plan_to_results PASSED [ 94%]
tests/test_upgrade_service.py::TestGetRenovationPlan::test_returns_plan_when_exists PASSED [ 94%]
tests/test_upgrade_service.py::TestGetRenovationPlan::test_returns_none_when_no_plan PASSED [ 94%]
tests/test_upgrade_service.py::TestGetRenovationPlan::test_rejects_wrong_user PASSED [ 94%]
tests/test_version_db.py::TestCheckVersionCurrency::test_known_current_version PASSED [ 94%]
tests/test_version_db.py::TestCheckVersionCurrency::test_known_outdated_version PASSED [ 95%]
tests/test_version_db.py::TestCheckVersionCurrency::test_eol_version PASSED [ 95%]
tests/test_version_db.py::TestCheckVersionCurrency::test_unknown_package PASSED [ 95%]
tests/test_version_db.py::TestCheckVersionCurrency::test_none_version PASSED [ 95%]
tests/test_version_db.py::TestCheckVersionCurrency::test_alias_resolution PASSED [ 95%]
tests/test_version_db.py::TestCheckVersionCurrency::test_react_current PASSED [ 95%]
tests/test_version_db.py::TestCheckVersionCurrency::test_react_eol PASSED [ 95%]
tests/test_version_db.py::TestCheckVersionCurrency::test_node_eol PASSED [ 96%]
tests/test_version_db.py::TestCheckAllDependencies::test_empty_inputs PASSED [ 96%]
tests/test_version_db.py::TestCheckAllDependencies::test_none_inputs PASSED [ 96%]
tests/test_version_db.py::TestCheckAllDependencies::test_python_deps_only PASSED [ 96%]
tests/test_version_db.py::TestCheckAllDependencies::test_mixed_deps PASSED [ 96%]
tests/test_version_db.py::TestCheckAllDependencies::test_sort_order PASSED [ 96%]
tests/test_version_db.py::TestCheckAllDependencies::test_unknown_packages PASSED [ 96%]
tests/test_version_db.py::TestGetAllVersionInfo::test_returns_dict PASSED [ 97%]
tests/test_version_db.py::TestGetAllVersionInfo::test_all_entries_have_latest PASSED [ 97%]
tests/test_version_db.py::TestGetAllVersionInfo::test_registry_not_empty PASSED [ 97%]
tests/test_webhook_router.py::test_webhook_accepts_valid_push PASSED     [ 97%]
tests/test_webhook_router.py::test_webhook_rejects_invalid_signature PASSED [ 97%]
tests/test_webhook_router.py::test_webhook_ignores_non_push_events PASSED [ 97%]
tests/test_webhook_router.py::test_list_audits PASSED                    [ 97%]
tests/test_webhook_router.py::test_list_audits_requires_auth PASSED      [ 97%]
tests/test_webhook_router.py::test_audit_detail_not_found PASSED         [ 98%]
tests/test_webhooks.py::test_valid_signature PASSED                      [ 98%]
tests/test_webhooks.py::test_invalid_signature PASSED                    [ 98%]
tests/test_webhooks.py::test_missing_prefix PASSED                       [ 98%]
tests/test_webhooks.py::test_wrong_secret PASSED                         [ 98%]
tests/test_ws_manager.py::test_connect_and_send PASSED                   [ 98%]
tests/test_ws_manager.py::test_disconnect_removes_socket PASSED          [ 98%]
tests/test_ws_manager.py::test_multiple_connections PASSED               [ 99%]
tests/test_ws_manager.py::test_send_to_nonexistent_user PASSED           [ 99%]
tests/test_ws_manager.py::test_broadcast_audit_update PASSED             [ 99%]
tests/test_ws_manager.py::test_dead_socket_ignored PASSED                [ 99%]
tests/test_ws_router.py::test_ws_rejects_missing_token PASSED            [ 99%]
tests/test_ws_router.py::test_ws_rejects_invalid_token PASSED            [ 99%]
tests/test_ws_router.py::test_ws_accepts_valid_token PASSED              [ 99%]
tests/test_ws_router.py::test_ws_connects_and_disconnects PASSED         [100%]

================================== FAILURES ===================================
________________________ test_cors_allows_valid_origin ________________________
tests\test_hardening.py:179: in test_cors_allows_valid_origin
    assert resp.status_code == 200
E   assert 400 == 200
E    +  where 400 = <Response [400 Bad Request]>.status_code
============================== warnings summary ===============================
C:\Users\krisd\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\formparsers.py:12
  C:\Users\krisd\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

C:\Users\krisd\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:690: 8 warnings
tests/test_audit_runner.py: 2 warnings
tests/test_builds_router.py: 39 warnings
tests/test_cost_gate.py: 6 warnings
tests/test_ws_router.py: 4 warnings
  C:\Users\krisd\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:690: DeprecationWarning: The 'app' shortcut is now deprecated. Use the explicit style 'transport=WSGITransport(app=...)' instead.
    warnings.warn(message, DeprecationWarning)

tests/test_build_service.py::test_cancel_build_no_active
  C:\Users\krisd\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:2188: RuntimeWarning: coroutine '_run_build' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_build_service.py::test_fail_build
  C:\Users\krisd\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:2188: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_git_client.py::test_commit
  Z:\ForgeCollection\ForgeGuard\app\clients\git_client.py:104: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    if not status.strip():
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_scout_service.py::test_start_scout_run_wrong_user
  C:\Users\krisd\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:2188: RuntimeWarning: coroutine '_execute_scout' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_upgrade_service.py::TestGetRenovationPlan::test_returns_plan_when_exists
  C:\Users\krisd\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:2188: RuntimeWarning: coroutine '_execute_deep_scan' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_hardening.py::test_cors_allows_valid_origin - assert 400 ==...
================= 1 failed, 736 passed, 65 warnings in 23.52s =================
